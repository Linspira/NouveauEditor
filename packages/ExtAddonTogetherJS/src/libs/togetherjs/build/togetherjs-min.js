/*! togetherjs 2014-02-27 */
!function(){function a(){var a=document.getElementById("togetherjs-stylesheet");if(!a){var b=document.createElement("link");b.id="togetherjs-stylesheet",b.setAttribute("rel","stylesheet"),b.href=g+f+"?bust="+p,document.head.appendChild(b)}}function b(a){var b=document.createElement("script");b.src=g+a+"?bust="+p,document.head.appendChild(b)}function c(){if(!window.TogetherJSConfig_noAutoStart){var a=window.TogetherJSConfig_callToStart;!a&&window.TowTruckConfig_callToStart&&(a=window.TowTruckConfig_callToStart,console.warn("Please rename TowTruckConfig_callToStart to TogetherJSConfig_callToStart")),window.TogetherJSConfig&&window.TogetherJSConfig.callToStart&&(a=window.TogetherJSConfig.callToStart),a?a(d):d()}}function d(){if(t.startup._joinShareId)t();else if(window._TogetherJSBookmarklet)delete window._TogetherJSBookmarklet,t();else{var a="togetherjs-session.status",b=sessionStorage.getItem(a);b?(b=JSON.parse(b),b&&b.running&&(t.startup.continued=!0,t.startup.reason=b.startupReason,t())):(window.TogetherJSConfig_autoStart||window.TogetherJSConfig&&window.TogetherJSConfig.autoStart)&&(t.startup.reason="joined",t())}}var e={dontShowClicks:!1,cloneClicks:!1,enableAnalytics:!1,analyticsCode:"UA-35433268-28",hubBase:null,getUserName:null,getUserColor:null,getUserAvatar:null,siteName:null,useMinimizedCode:void 0,on:{},hub_on:{},enableShortcut:!1,toolName:null,findRoom:null,autoStart:!1,suppressJoinConfirmation:!1,suppressInvite:!1,inviteFromRoom:null,storagePrefix:"togetherjs",includeHashInUrl:!1,disableWebRTC:!1,youtube:!0,ignoreMessages:["cursor-update","keydown","scroll-update"],ignoreForms:[":password"]},f="/togetherjs/togetherjs.css",g="";"__baseUrl__"==g&&(g="");var h=!1,i=localStorage.getItem("togetherjs.baseUrlOverride");if(i){try{i=JSON.parse(i)}catch(j){i=null}if(!i||i.expiresAt<Date.now())localStorage.removeItem("togetherjs.baseUrlOverride");else{g=i.baseUrl;var k=console.warn||console.log;k.call(console,"Using TogetherJS baseUrlOverride:",g),k.call(console,"To undo run: localStorage.removeItem('togetherjs.baseUrlOverride')")}}var l=localStorage.getItem("togetherjs.configOverride");if(l){try{l=JSON.parse(l)}catch(j){l=null}if(!l||l.expiresAt<Date.now())localStorage.removeItem("togetherjs.configOverride");else{var m=!1;for(var n in l)"expiresAt"!=n&&l.hasOwnProperty(n)&&(m||(console.warn("Using TogetherJS configOverride"),console.warn("To undo run: localStorage.removeItem('togetherjs.configOverride')")),window["TogetherJSConfig_"+n]=l[n],console.log("Config override:",n,"=",l[n]))}}var o="unknown",p="";if(p&&""!=p?o=p:p=Date.now()+"","undefined"==typeof console&&(console={}),console.log||(console.log=function(){}),["debug","info","warn","error"].forEach(function(a){console[a]||(console[a]=console.log)}),!g)for(var q=document.getElementsByTagName("script"),r=0;r<q.length;r++){var s=q[r].src;if(s&&-1!==s.search(/togetherjs.js(\?.*)?$/)){g=s.replace(/\/*togetherjs.js(\?.*)?$/,""),console.warn("Detected baseUrl as",g);break}if(s&&-1!==s.search(/togetherjs-min.js(\?.*)?$/)){g=s.replace(/\/*togetherjs-min.js(\?.*)?$/,""),console.warn("Detected baseUrl as",g);break}}g||console.warn("Could not determine TogetherJS's baseUrl (looked for a <script> with togetherjs.js and togetherjs-min.js)");var t=window.TogetherJS=function z(c){function d(){z._loaded=!0,h||(z.require=require.config({context:"togetherjs"}),z._requireObject=require)}if(z.running){var e=z.require("session");return void e.close()}z.startup.button=null;try{c&&"object"==typeof c&&(c.target?z.startup.button=c.target:1==c.nodeType?z.startup.button=c:c[0]&&1==c[0].nodeType&&(z.startup.button=c[0]))}catch(f){console.warn("Error determining starting button:",f)}window.TowTruckConfig&&(console.warn("TowTruckConfig is deprecated; please use TogetherJSConfig"),window.TogetherJSConfig?console.warn("Ignoring TowTruckConfig in favor of TogetherJSConfig"):window.TogetherJSConfig=TowTruckConfig),window.TogetherJSConfig&&!window.TogetherJSConfig.loaded&&(z.config(window.TogetherJSConfig),window.TogetherJSConfig.loaded=!0);var g,i,j={};for(g in window)0===g.indexOf("TogetherJSConfig_on_")?(i=g.substr("TogetherJSConfig_on_".length),j[i]=window[g]):0===g.indexOf("TogetherJSConfig_")?(i=g.substr("TogetherJSConfig_".length),z.config(i,window[g])):0===g.indexOf("TowTruckConfig_on_")?(i=g.substr("TowTruckConfig_on_".length),console.warn("TowTruckConfig_* is deprecated, please rename",g,"to TogetherJSConfig_on_"+i),j[i]=window[g]):0===g.indexOf("TowTruckConfig_")&&(i=g.substr("TowTruckConfig_".length),console.warn("TowTruckConfig_* is deprecated, please rename",g,"to TogetherJSConfig_"+i),z.config(i,window[g]));var k=z.config.get("on");for(g in j)j.hasOwnProperty(g)&&(k[g]=j[g]);z.config("on",k);for(g in k)z.on(g,k[g]);var l=z.config.get("hub_on");if(l)for(g in l)l.hasOwnProperty(g)&&z.hub.on(g,l[g]);if(z.startup.reason||(z.startup.reason="started"),z._loaded){var e=z.require("session");return a(),void e.start()}z.startup._launch=!0,a();var m=z.config.get("useMinimizedCode");z.config.close("useMinimizedCode"),void 0!==m&&(h=!!m);var n=z._extend(z.requireConfig),o=["session","jquery"];if(!h&&"function"==typeof require){if(!require.config)throw console.warn("The global require (",require,") is not requirejs; please use togetherjs-min.js"),new Error("Conflict with window.require");z.require=require.config(n)}"function"==typeof z.require?z.require(o,d):(n.deps=o,n.callback=d,h||(window.require=n)),b(h?"/togetherjs/togetherjsPackage.js":"/togetherjs/libs/require.js")};t.pageLoaded=Date.now(),t._extend=function(a,b){b||(b=a,a={});for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},t._startupInit={button:null,reason:null,continued:!1,_joinShareId:null,_launch:!1},t.startup=t._extend(t._startupInit),t.running=!1,t.requireConfig={context:"togetherjs",baseUrl:g+"/togetherjs",urlArgs:"bust="+p,paths:{jquery:"libs/jquery-1.8.3.min",walkabout:"libs/walkabout/walkabout",esprima:"libs/walkabout/lib/esprima",falafel:"libs/walkabout/lib/falafel",tinycolor:"libs/tinycolor",whrandom:"libs/whrandom/random"}},t._mixinEvents=function(a){return a.on=function(a,b){if("function"!=typeof b)throw console.warn("Bad callback for",this,".once(",a,", ",b,")"),"Error: .once() called with non-callback";if(-1!=a.search(" ")){var c=a.split(/ +/g);return void c.forEach(function(a){this.on(a,b)},this)}if(this._knownEvents&&-1==this._knownEvents.indexOf(a)){var d=""+this;d.length>20&&(d=d.substr(0,20)+"..."),console.warn(d+".on('"+a+"', ...): unknown event"),console.trace&&console.trace()}this._listeners||(this._listeners={}),this._listeners[a]||(this._listeners[a]=[]),-1==this._listeners[a].indexOf(b)&&this._listeners[a].push(b)},a.once=function(a,b){if("function"!=typeof b)throw console.warn("Bad callback for",this,".once(",a,", ",b,")"),"Error: .once() called with non-callback";var c="onceCallback_"+a;b[c]||(b[c]=function d(){b.apply(this,arguments),this.off(a,d),delete b[c]}),this.on(a,b[c])},a.off=a.removeListener=function(a,b){if(this._listenerOffs)return void this._listenerOffs.push([a,b]);if(-1!=a.search(" ")){var c=a.split(/ +/g);return void c.forEach(function(a){this.off(a,b)},this)}if(this._listeners&&this._listeners[a])for(var d=this._listeners[a],e=d.length,f=0;e>f;f++)if(d[f]==b){d.splice(f,1);break}},a.emit=function(a){var b=this._listenerOffs=[];if(this._listeners&&this._listeners[a]){var c=Array.prototype.slice.call(arguments,1),d=this._listeners[a];d.forEach(function(a){a.apply(this,c)},this),delete this._listenerOffs,b.length&&b.forEach(function(a){this.off(a[0],a[1])},this)}},a},t._teardown=function(){var a=t._requireObject||window.require;a.s&&a.s.contexts&&delete a.s.contexts.togetherjs,t._loaded=!1,t.startup=t._extend(t._startupInit),t.running=!1},t._mixinEvents(t),t._knownEvents=["ready","close"],t.toString=function(){return"TogetherJS"};var u="https://hub.togetherjs.com";"__hubUrl__"==u&&(u="https://hub.togetherjs.mozillalabs.com"),e.hubBase=u,t._configuration={},t._defaultConfiguration=e,t._configTrackers={},t._configClosed={},t.config=function(a,b){var c;if(1==arguments.length){if("object"!=typeof a)throw new Error("TogetherJS.config(value) must have an object value (not: "+a+")");c=a}else c={},c[a]=b;var d,e;for(var f in c)if(c.hasOwnProperty(f)&&t._configClosed[f]&&t.running)throw new Error("The configuration "+f+" is finalized and cannot be changed");for(var f in c)if(c.hasOwnProperty(f)&&"loaded"!=f&&"callToStart"!=f){t._defaultConfiguration.hasOwnProperty(f)||console.warn("Unknown configuration value passed to TogetherJS.config():",f);var g=t._configuration[f],h=c[f];t._configuration[f]=h;var i=t._configTrackers[a]||[],j=!1;for(d=0;d<i.length;d++)try{e=i[d],e(h,g)}catch(k){console.warn("Error setting configuration",a,"to",h,":",k,"; reverting to",g),j=!0;break}if(j)for(t._configuration[f]=g,d=0;d<i.length;d++)try{e=i[d],e(h)}catch(k){console.warn("Error REsetting configuration",a,"to",g,":",k,"(ignoring)")}}},t.config.get=function(a){var b=t._configuration[a];return void 0===b&&(t._defaultConfiguration.hasOwnProperty(a)||console.error("Tried to load unknown configuration value:",a),b=t._defaultConfiguration[a]),b},t.config.track=function(a,b){if(!t._defaultConfiguration.hasOwnProperty(a))throw new Error("Configuration is unknown: "+a);return b(t.config.get(a)),t._configTrackers[a]||(t._configTrackers[a]=[]),t._configTrackers[a].push(b),b},t.config.close=function(a){if(!t._defaultConfiguration.hasOwnProperty(a))throw new Error("Configuration is unknown: "+a);t._configClosed[a]=!0},t.reinitialize=function(){t.running&&"function"==typeof t.require&&t.require(["session"],function(a){a.emit("reinitialize")})},t.refreshUserData=function(){t.running&&"function"==typeof t.require&&t.require(["session"],function(a){a.emit("refresh-user-data")})},t.version=o,t.baseUrl=g,t.hub=t._mixinEvents({}),t._onmessage=function(a){var b=a.type;b=0===b.search(/^app\./)?b.substr("app.".length):"togetherjs."+b,a.type=b,t.hub.emit(a.type,a)},t.send=function(a){if(!t.require)throw"You cannot use TogetherJS.send() when TogetherJS is not running";var b=t.require("session");b.appSend(a)},t.shareUrl=function(){if(!t.require)return null;var a=t.require("session");return a.shareUrl()};var v=null;t.listenForShortcut=function(){console.warn("Listening for alt-T alt-T to start TogetherJS"),t.removeShortcut(),v=function a(b){84==b.which&&b.altKey?a.pressed?t():a.pressed=!0:a.pressed=!1},t.once("ready",t.removeShortcut),document.addEventListener("keyup",v,!1)},t.removeShortcut=function(){v&&(document.addEventListener("keyup",v,!1),v=null)},t.config.track("enableShortcut",function(a,b){a?t.listenForShortcut():b&&t.removeShortcut()}),t.checkForUsersOnChannel=function(a,b){0===a.search(/^https?:/i)&&(a=a.replace(/^http/i,"ws"));var c=new WebSocket(a),d=!1;c.onmessage=function(a){var e=JSON.parse(a.data);return"init-connection"!=e.type?void console.warn("Got unexpected first message (should be init-connection):",e):d?(console.warn("Somehow received two responses from channel; ignoring second"),void c.close()):(d=!0,c.close(),void b(e.peerCount))},c.onclose=c.onerror=function(){d||(console.warn("Socket was closed without receiving answer"),d=!0,b(void 0))}};var w=location.hash.replace(/^#/,""),x=/&?togetherjs=([^&]*)/.exec(w);if(x){t.startup._joinShareId=x[1],t.startup.reason="joined";var y=w.substr(0,x.index)+w.substr(x.index+x[0].length);location.hash=y}window._TogetherJSShareId&&(t.startup._joinShareId=window._TogetherJSShareId,delete window._TogetherJSShareId),c(),window.TogetherJSConfig_enableShortcut&&t.listenForShortcut(),window.TowTruck=t}();